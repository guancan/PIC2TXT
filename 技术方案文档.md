# pics_2_txt 技术方案

## 项目概述
**pics_2_txt** 是一个简单的批量图片/PDF处理工具，主要功能是下载图片并进行OCR识别。支持本地OCR引擎和在线OCR服务。

## 简化技术选型

### 前端方案
- **Streamlit**：使用Python直接构建简单界面，无需学习前端技术

### 后端方案
- **纯Python实现**：不使用复杂的FastAPI+Celery架构
- **SQLite**：轻量级数据库，无需安装额外服务
- **OCR引擎**：
  - 本地引擎：PaddleOCR
  - 在线服务：Mistral AI OCR

## 系统架构
```
+----------------+      +----------------+
|                |      |                |
|  Streamlit UI  +----->+  Python后端    |
|  (前端界面)     |      |  (处理逻辑)    |
|                |      |                |
+----------------+      +-------+--------+
                                |
                                v
                +---------------+---------------+
                |                               |
+---------------v-----------+   +---------------v-----------+
|                           |   |                           |
|   本地PaddleOCR引擎        |   |   Mistral AI OCR服务      |
|                           |   |                           |
+---------------------------+   +---------------------------+
```

## 功能模块
1. **下载模块**
   - 支持输入图片/PDF链接
   - 简单的下载功能
2. **OCR处理模块**
   - 支持本地PaddleOCR引擎
   - 支持Mistral AI在线OCR服务
   - 统一的OCR服务接口
3. **任务管理**
   - 基本的任务列表
   - 查看任务状态
   - 支持选择OCR引擎
4. **结果展示**
   - 显示OCR结果
   - 导出为TXT文件

## 实现方案

### 项目结构
```
pics_2_txt/
│
├── app.py                  # 主程序入口，Streamlit应用
├── config.py               # 配置文件，存储路径、OCR设置等
│
├── database/
│   ├── __init__.py
│   ├── db_manager.py       # 数据库管理类（保留）
│   └── models.py           # 数据模型定义
│
├── services/
│   ├── __init__.py
│   ├── download_service.py # 图片/PDF下载服务（重命名）
│   ├── ocr/                # OCR服务模块（保留）
│   │   ├── __init__.py
│   │   ├── base_ocr.py     # OCR服务基类
│   │   ├── paddle_ocr.py   # PaddleOCR实现
│   │   └── mistral_ocr.py  # Mistral AI OCR实现
│   ├── ocr_factory.py      # OCR服务工厂
│   └── task_service.py     # 任务处理服务
│
├── utils/
│   ├── __init__.py
│   ├── file_utils.py       # 文件处理工具
│   └── ocr_utils.py        # OCR相关工具函数
│
├── ui/
│   ├── __init__.py
│   ├── home_page.py        # 首页UI组件
│   ├── task_page.py        # 任务管理页面UI组件
│   └── result_page.py      # 结果展示页面UI组件
│
├── data/                   # 存储下载的图片和处理结果
│   ├── downloads/          # 下载的原始文件
│   └── results/            # OCR处理结果
│
└── database.db             # SQLite数据库文件
```

### 技术实现
- 使用Python标准库`requests`下载图片
- 使用PaddleOCR进行本地OCR识别
- 使用Mistral AI API进行在线OCR识别
- 使用SQLite存储任务和结果
- 使用Streamlit构建所有界面

## 数据库表设计

### 任务表 (tasks)
```
- id: INTEGER PRIMARY KEY
- url: TEXT                 # 图片/PDF的URL
- file_path: TEXT           # 本地文件路径
- status: TEXT              # 状态：pending, processing, completed, failed
- ocr_engine: TEXT          # OCR引擎类型：local, mistral
- created_at: TIMESTAMP     # 创建时间
- updated_at: TIMESTAMP     # 更新时间
- error_message: TEXT       # 错误信息（如果有）
```

### 结果表 (results)
```
- id: INTEGER PRIMARY KEY
- task_id: INTEGER          # 关联的任务ID
- text_content: TEXT        # OCR识别的文本内容
- result_path: TEXT         # 结果文件路径
- created_at: TIMESTAMP     # 创建时间
```

## 模块详细设计

### 1. 配置模块 (config.py)
集中管理所有配置信息，包括：
- 文件路径配置
- 数据库配置
- OCR引擎配置
- API密钥配置

### 2. 数据库模块 (database/)

**models.py**：定义数据库表结构和常量
- 任务状态常量
- 表结构定义
- OCR引擎类型常量

**db_manager.py**：提供数据库操作接口
- 数据库连接管理
- 任务和结果的CRUD操作

### 3. OCR服务模块 (services/ocr/)

**base_ocr.py**：定义OCR服务基类接口
- 初始化方法
- 图片处理方法
- 批量处理方法

**paddle_ocr.py**：实现本地PaddleOCR服务
- 继承基类接口
- 实现PaddleOCR特定功能

**mistral_ocr.py**：实现Mistral AI OCR服务
- 继承基类接口
- 实现Mistral API调用

### 4. 服务工厂 (services/ocr_factory.py)
- 根据配置创建不同的OCR服务实例
- 提供统一的服务创建接口

### 5. 任务服务 (services/task_service.py)
- 管理任务生命周期
- 协调下载和OCR处理
- 更新任务状态和结果

### 6. 下载服务 (services/download_service.py)
- 处理URL下载
- 支持不同文件类型
- 错误处理和重试

### 7. UI模块 (ui/)
使用Streamlit构建用户界面，包括：
- 任务提交页面
- 任务列表和状态页面
- 结果查看和导出页面

## 开发步骤

1. **更新项目结构**：调整目录和文件组织
2. **实现配置模块**：集中管理配置信息
3. **更新数据库模块**：统一表结构定义
4. **重构OCR服务**：实现基类和具体实现类
5. **完善任务服务**：支持多种OCR引擎
6. **更新UI界面**：添加OCR引擎选择功能

## 注意事项

1. **接口一致性**：确保不同OCR服务提供一致的接口
2. **错误处理**：完善各模块的错误处理机制
3. **配置管理**：集中管理API密钥等敏感信息
4. **代码复用**：避免重复代码，提取共用功能